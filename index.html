<html>

<head>
  <title>poe-try — tries to generate words inspired by the works of Poe</title>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="poe-try — tries to generate words inspired by the works of Poe" />
  <meta name="keywords" content="poe-try, poe, ltsm" />
  <link rel="shortcut icon" type="image/png" href="/favicon.png" />
  <style>
    body {
      background-color: hsl(0, 0%, 18.8%);
      color: hsl(0, 0%, 58.8%);
      font-size: 22px;
    }
    a { color:hsl(17.4, 46.7%, 64%); }
    a:hover { color:hsla(17.4, 46.7%, 64%, 0.5); }
    a:visited { color:hsla(17.4, 46.7%, 64%, 0.75); }
    .poe-try-text { font-family: serif; margin:1em;}
    .about {color:hsl(85.1, 63%, 57.6%)}
    .make-a-new-poem {
      font-size: 1em;
      margin: 0.5em 0;
    }
  </style>
</head>
<script src="https://unpkg.com/ml5@0.1.1/dist/ml5.min.js" type="text/javascript"></script>

<body>
  <section aria-label="Where the robot's poem goes" aria-live="polite" class="poe-try-text">
    <pre id="put-text-here"></pre>
  </section>
  <section aria-label="About poe-try" class="poe-try-text about">
    <pre>
> hello #procjam!
> poe-try is thinking of a nice poem for you! 
> poe-try is not the fastest robot
> but poe-try appreciates your patience. 
> :)
> <a href="https://github.com/alexcpendleton/poe-try">find out more about poe-try</a>
> <button id="new-poem" class="make-a-new-poem" name="make a new poem" onclick="generate()">Make a New Poem</button>
  </pre>
  </section>
  <script src="PoeTry.js" type="text/javascript"></script>
  <script src="data/windowlines.js" type="text/javascript"></script>

  <script type="text/javascript">
    function lstmFromFiles(callback) {
      const modelDirectoryPath = "models/training";
      return new ml5.LSTMGenerator(modelDirectoryPath, callback);
    }
    function logg() {
      console.log(...arguments);
    }
    function loadEmUp() {
      logg("Loading model...");
      var debug = true;
      let lstm = {};
      let poe = {};
      let lstmLoader = lstmFromFiles;

      lstm = lstmLoader(modelLoaded);

      const target = document.getElementById("put-text-here");
      async function generate() {
        let options = grabVars();
        let text = await poe.run(options);
        target.innerText = text;
        const data = {
          poe,
          text,
          target
        };
        document.dispatchEvent(new Event("PoeTry.generated", data));
        return data;
      }
      function grabVars() {
        let searchParams = new URL(document.location).searchParams;
        function qp(name, def) {
          let value = searchParams.get(name)
          if (value === null || value === undefined || value === "") {
            value = def;
          }
          return value;
        }
        const vars = {
          seed: qp("seed", null),
          length: qp("length", -1),
          times: 1,
          temperature: qp("temperature", 0),
        };
        return vars;
      }
      async function modelLoaded() {
        logg("Model loaded!");

        poe = new PoeTry({
          lstm: lstm,
          seeds: window.lines,
          debug: debug
        });
        window.poe = poe;
        if (debug) {
          console.log("poe", poe);
        }
        generate();
      }
      window.generate = generate;
    }
    loadEmUp();
  </script>
</body>

</html>